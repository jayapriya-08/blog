---
title: "GitHub Actions: How to Create Pull Requests Automatically"
date: 2019-10-11T19:07:35+09:00
author: Peter Evans
description: "Making pull requests to a GitHub repository automatically with GitHub Actions"
keywords: ["github", "github actions", "workflow", "pull request", "automation", "ci", "bot"]
---

Introducing one of the first GitHub Actions I wrote and [published to the GitHub Marketplace](https://github.com/marketplace/actions/create-pull-request). A generic action to automatically create a pull request for changes to your repository in the Actions workspace.

### create-pull-request

Changes to a repository in the Actions workspace persist between steps in a workflow.
The [create-pull-request](https://github.com/peter-evans/create-pull-request) action is designed to be used in conjunction with other steps that modify or add files to your repository.
The local changes will be automatically committed to a new branch and a pull request created.

Create Pull Request action will:

1. Check for repository changes in the Actions workspace. This includes untracked (new) files as well as modified files.
2. Commit all changes to a new branch, or update an existing pull request branch.
3. Create a pull request to merge the new branch into the currently active branch executing the workflow.

There are many interesting use-cases for this type of action, such as...

- Process management bots
- Synchronization with external data sources
- Updating contract definitions (API, Swagger docs, etc.)
- Code linting/formatting
- Static analysis/fixes
- Scheduled process management

### Basic example workflow

Here is simple example that adds a dated report to a repository and raises a pull request.

<div class="highlight highlight-source-yaml"><pre><span class="pl-ent">on</span>:
  <span class="pl-ent">schedule</span>:
    - <span class="pl-ent">cron</span>: <span class="pl-s"><span class="pl-pds">'</span>0 10 * * *<span class="pl-pds">'</span></span>
<span class="pl-ent">name</span>: <span class="pl-s">create-pull-request workflow</span>
<span class="pl-ent">jobs</span>:
  <span class="pl-ent">createPullRequest</span>:
    <span class="pl-ent">runs-on</span>: <span class="pl-s">ubuntu-latest</span>
    <span class="pl-ent">steps</span>:
      - <span class="pl-ent">uses</span>: <span class="pl-s">actions/checkout@v1</span>
      - <span class="pl-ent">name</span>: <span class="pl-s">Create report file</span>
        <span class="pl-ent">run</span>: <span class="pl-s">date +%s &gt; report.txt</span>
      - <span class="pl-ent">name</span>: <span class="pl-s">Create Pull Request</span>
        <span class="pl-ent">uses</span>: <span class="pl-s">peter-evans/create-pull-request@v1.7.0</span>
        <span class="pl-ent">with</span>:
          <span class="pl-ent">token</span>: <span class="pl-s">${{ secrets.GITHUB_TOKEN }}</span>
          <span class="pl-ent">commit-message</span>: <span class="pl-s">Add report file</span>
          <span class="pl-ent">title</span>: <span class="pl-s"><span class="pl-pds">'</span>[Example] Add report file<span class="pl-pds">'</span></span>
          <span class="pl-ent">body</span>: <span class="pl-s">&gt;</span>
<span class="pl-s">            This PR is auto-generated by </span>
<span class="pl-s">            [create-pull-request](https://github.com/peter-evans/create-pull-request).</span>
<span class="pl-s"></span>          <span class="pl-ent">labels</span>: <span class="pl-s">report, automated pr</span></pre></div>

This is an example of what pull requests created with the action look like on GitHub.

<img src="/img/pull-request-example.png" alt="Pull Request Example" width="700">

### Example workflow to automate periodic dependency updates

This example workflow executes once a week and will create a pull request for any dependency updates. This pattern will work well for updating any kind of static content from an external source.

<div class="highlight highlight-source-yaml"><pre><span class="pl-ent">name</span>: <span class="pl-s">Update Dependencies</span>
<span class="pl-ent">on</span>:
  <span class="pl-ent">schedule</span>:
    - <span class="pl-ent">cron</span>:  <span class="pl-s"><span class="pl-pds">'</span>0 10 * * 1<span class="pl-pds">'</span></span>
<span class="pl-ent">jobs</span>:
  <span class="pl-ent">update-deps</span>:
    <span class="pl-ent">runs-on</span>: <span class="pl-s">ubuntu-latest</span>
    <span class="pl-ent">steps</span>:
      - <span class="pl-ent">uses</span>: <span class="pl-s">actions/checkout@v1</span>
      - <span class="pl-ent">uses</span>: <span class="pl-s">actions/setup-node@v1</span>
        <span class="pl-ent">with</span>:
          <span class="pl-ent">node-version</span>: <span class="pl-s"><span class="pl-pds">'</span>10.x<span class="pl-pds">'</span></span>
      - <span class="pl-ent">name</span>: <span class="pl-s">Update dependencies</span>
        <span class="pl-ent">id</span>: <span class="pl-s">vars</span>
        <span class="pl-ent">run</span>: <span class="pl-s">|</span>
<span class="pl-s">          npm install -g npm-check-updates</span>
<span class="pl-s">          ncu -u</span>
<span class="pl-s">          npm install</span>
<span class="pl-s"></span>      - <span class="pl-ent">name</span>: <span class="pl-s">Create Pull Request</span>
        <span class="pl-ent">uses</span>: <span class="pl-s">peter-evans/create-pull-request@v1.7.0</span>
        <span class="pl-ent">with</span>:
          <span class="pl-ent">token</span>: <span class="pl-s">${{ secrets.GITHUB_TOKEN }}</span>
          <span class="pl-ent">commit-message</span>: <span class="pl-s">update dependencies</span>
          <span class="pl-ent">author-email</span>: <span class="pl-s">peter-evans@users.noreply.github.com</span>
          <span class="pl-ent">author-name</span>: <span class="pl-s">Peter Evans</span>
          <span class="pl-ent">title</span>: <span class="pl-s">Automated Dependency Updates</span>
          <span class="pl-ent">body</span>: <span class="pl-s">This is an auto-generated PR with dependency updates.</span>
          <span class="pl-ent">labels</span>: <span class="pl-s">dep-updates, automated pr</span>
          <span class="pl-ent">reviewers</span>: <span class="pl-s">peter-evans</span>
          <span class="pl-ent">branch</span>: <span class="pl-s">dep-updates</span>
          <span class="pl-ent">branch-suffix</span>: <span class="pl-s">none</span></pre></div>

### Example usage with "on: pull_request" workflows

The following is an example workflow for a use-case where [autopep8 action](https://github.com/peter-evans/autopep8) runs as both a check on pull requests and raises a further pull request to apply code fixes. This is a pattern that would work well for any automated code linting and fixing.

How it works:

1. When a pull request is raised the workflow executes as a check.
2. If autopep8 makes any fixes a pull request will be raised for those fixes to be merged into the current pull request branch. The workflow then deliberately causes the check to fail.
3. When the pull request containing the fixes is merged the workflow runs again. This time autopep8 makes no changes and the check passes.
4. The original pull request can now be merged.

Note that due to [limitations on forked repositories](https://help.github.com/en/github/automating-your-workflow-with-github-actions/virtual-environments-for-github-actions#token-permissions) this workflow does not work for pull requests raised from forks.

<div class="highlight highlight-source-yaml"><pre><span class="pl-ent">name</span>: <span class="pl-s">autopep8</span>
<span class="pl-ent">on</span>: <span class="pl-s">pull_request</span>
<span class="pl-ent">jobs</span>:
  <span class="pl-ent">autopep8</span>:
    <span class="pl-c"><span class="pl-c">#</span> Check if the PR is not raised by this workflow and is not from a fork</span>
    <span class="pl-ent">if</span>: <span class="pl-s">startsWith(github.head_ref, 'autopep8-patches') == false && github.event.pull_request.head.repo.full_name == github.repository</span>
    <span class="pl-ent">runs-on</span>: <span class="pl-s">ubuntu-latest</span>
    <span class="pl-ent">steps</span>:
      - <span class="pl-ent">uses</span>: <span class="pl-s">actions/checkout@v1</span>
      - <span class="pl-ent">name</span>: <span class="pl-s">autopep8</span>
        <span class="pl-ent">id</span>: <span class="pl-s">autopep8</span>
        <span class="pl-ent">uses</span>: <span class="pl-s">peter-evans/autopep8@v1.1.0</span>
        <span class="pl-ent">with</span>:
          <span class="pl-ent">args</span>: <span class="pl-s">--exit-code --recursive --in-place --aggressive --aggressive .</span>
      - <span class="pl-ent">name</span>: <span class="pl-s">Set autopep8 branch name</span>
        <span class="pl-ent">id</span>: <span class="pl-s">vars</span>
        <span class="pl-ent">run</span>: <span class="pl-s">echo ::set-output name=branch-name::"autopep8-patches/$GITHUB_HEAD_REF"</span>
      - <span class="pl-ent">name</span>: <span class="pl-s">Create Pull Request</span>
        <span class="pl-ent">if</span>: <span class="pl-s">steps.autopep8.outputs.exit-code == 2</span>
        <span class="pl-ent">uses</span>: <span class="pl-s">peter-evans/create-pull-request@v1.7.0</span>
        <span class="pl-ent">with</span>:
          <span class="pl-ent">token</span>: <span class="pl-s">${{ secrets.GITHUB_TOKEN }}</span>
          <span class="pl-ent">commit-message</span>: <span class="pl-s">autopep8 action fixes</span>
          <span class="pl-ent">author-email</span>: <span class="pl-s">peter-evans@users.noreply.github.com</span>
          <span class="pl-ent">author-name</span>: <span class="pl-s">Peter Evans</span>
          <span class="pl-ent">title</span>: <span class="pl-s">Fixes by autopep8 action</span>
          <span class="pl-ent">body</span>: <span class="pl-s">This is an auto-generated PR with fixes by autopep8.</span>
          <span class="pl-ent">labels</span>: <span class="pl-s">autopep8, automated pr</span>
          <span class="pl-ent">reviewers</span>: <span class="pl-s">peter-evans</span>
          <span class="pl-ent">branch</span>: <span class="pl-s">${{ steps.vars.outputs.branch-name }}</span>
          <span class="pl-ent">branch-suffix</span>: <span class="pl-s">none</span>
      - <span class="pl-ent">name</span>: <span class="pl-s">Fail if autopep8 made changes</span>
        <span class="pl-ent">if</span>: <span class="pl-s">steps.autopep8.outputs.exit-code == 2</span>
        <span class="pl-ent">run</span>: <span class="pl-s">exit 1</span></pre></div>

See the [create-pull-request](https://github.com/peter-evans/create-pull-request) repository for the latest version and full usage details.
